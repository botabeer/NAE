from flask import Flask, request, abort
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import MessageEvent, TextMessage, TextSendMessage
import random, os

app = Flask(__name__)

LINE_CHANNEL_ACCESS_TOKEN = os.environ.get('LINE_CHANNEL_ACCESS_TOKEN')
LINE_CHANNEL_SECRET = os.environ.get('LINE_CHANNEL_SECRET')

line_bot_api = LineBotApi(LINE_CHANNEL_ACCESS_TOKEN)
handler = WebhookHandler(LINE_CHANNEL_SECRET)

# -------------------------------------------------------
# ุงูุฃุณุฆูุฉ (ุญุจ + ุตุฑุงุญุฉ + ุฑููุงูุณูุฉ) - ุฃูุซุฑ ูู 200 ุณุคุงู
# -------------------------------------------------------
questions = [
"ูุง ุฃูุซุฑ ุดูุก ุชุญุจู ูู ุดุฑูู ุญูุงุชูุ",
"ุงุนุชุฑู ุจุดูุก ุชุฎููู ุนูู.",
"ูู ุณุจู ููุฏูุช ุนูู ุชุตุฑู ูุน ุดุฑูููุ",
"ูู ุชุบุงุฑ ุนููู ูุซูุฑุ",
"ูู ุชุดุนุฑ ุฃูู ููููู ุจุฏูู ููุงูุ",
"ูุง ุฃูู ุดูุก ุฌุฐุจู ูููุ",
"ูู ุชุนุชุจุฑ ููุณู ุงูุทุฑู ุงูุฃูุซุฑ ุญุจุงูุ",
"ูู ุชุญุจ ุงูููุงุฌุขุช ุงูุฑููุงูุณูุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฌุนูู ุชุจุชุณู ูุนูุ",
"ูุง ุฃุฌูู ุฐูุฑู ุจููููุงุ",
"ูู ุชุซู ุจู ุซูุฉ ูุงููุฉุ",
"ูู ุชุญุจ ุชุจุฏุฃ ุจุงููุตุงูุญุฉ ุฃู ุชูุชุธุฑุ",
"ูุง ุฃูู ุดุนูุฑ ุญุณููุชู ููุง ุดูุชู ุฃูู ูุฑุฉุ",
"ูุง ุฃูุซุฑ ุชุตุฑู ูุฎููู ููุณุจ ุฑุถุงู ุจุณุฑุนุฉุ",
"ูู ุชูุถู ุงูููุงููุงุช ุงูุทูููุฉ ุฃู ุงูุฑุณุงุฆู ุงููุตูุฑุฉุ",
"ูู ุณุจู ุจููุช ูู ุดููู ููุ",
"ูู ุชุชุฎูู ุงููุณุชูุจู ูุนูุ",
"ูุง ุฃูุซุฑ ูููุฉ ุชุญุจ ุชุณูุนูุง ูููุ",
"ูู ุชุญุจ ุงูููุงุฌุขุช ุงูุจุณูุทุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฐูุฑู ููู ุนูุฏูุง ูุบูุจุ",
"ุงุนุชุฑู ุจุฃุบุฑุจ ุดุนูุฑ ุดุนุฑุช ุจู ุชุฌุงู ุดุฑููู.",
"ุงุนุชุฑู ุจุฃูุจุฑ ุฎุทุฃ ุงุฑุชูุจุชู ูู ุงูุนูุงูุฉ.",
"ูุง ุฃูุซุฑ ูููู ุฎูุงู ุชููู (ุฃูุง ูุญุธูุธ ููู).",
"ูุง ุฃูุซุฑ ูุญุธุฉ ุฑููุงูุณูุฉ ุญููุช ุจูุง ูุนูุ",
"ูู ุชูุถู ุงูููุงู ุฃู ุงูุฃูุนุงู ูู ุงูุญุจุ",
"ูุง ุฃูุซุฑ ุตูุฉ ุชุฌุนูู ุชุญุจู ุฃูุซุฑุ",
"ูู ุณุจู ูููุช ุฃุญุจู ุฃููุ",
"ูู ุชุญุจ ุฃู ูุณูุนู ุฏุงูููุง ูููุงุช ุญุจุ",
"ูู ุณุจู ููุชุจุช ูู ุฑุณุงูุฉ ุญุจุ",
"ูู ุชุชููุน ุฃู ุญุจูู ููุจุฑ ูุน ุงูููุชุ",
"ูู ุชุซู ููู ููุช ุงูุบูุงุจุ",
"ูู ุชุนุชูุฏ ุฃู ุงูุญุจ ุชุถุญูุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฌุนูู ุชุดุชุงู ููุ",
"ูู ุชุญุจ ุชุจุฏุฃ ุจุงููุตุงูุญุฉ ุฃู ุชูุชุธุฑุ",
"ูุง ุฃูุซุฑ ูููุฉ ูููููุง ูุชุคุซุฑ ูููุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฌุนูู ุชุญุณ ุจุงูุฃูุงู ูุนูุ",
"ูุง ุฃูุซุฑ ุชุตุฑู ูุบูุธู ูููุ",
"ูู ุชุบุงุฑ ุนููู ูู ุงููุงุณุ",
"ูุง ุฃูุซุฑ ูุญุธุฉ ุญุณููุช ุฃูู ูุนูุงู ูุญุจูุ",
"ูู ุชุชููู ูุนูุด ููุณ ูุดุงุนุฑูุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฐูุฑู ููู ููุง ุชุณูุน ุฃุบููุฉุ",
"ูู ุณุจู ููุงุฌุฃู ุจุดูุก ุฌูููุ",
"ูู ุชุญุจ ุงูููุงุฌุขุช ุฃู ุงููุฏุงูุง ุงูุฑูุฒูุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ุชุฎุงู ุชููุฏู ูููุ",
"ูู ุณุจู ูููุชูุง ูุฃูุชู ุฒุนูุงูููุ",
"ูู ุชุณุงูุญ ุจุณูููุฉุ",
"ูู ุชุญุจ ุงูุนุชุงุจ ุงูุทููู ุฃู ุงููุตูุฑุ",
"ูุง ุฃูุซุฑ ุดูุก ูุญุณุณูู ุจูููุชูุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฏู ุชุบูุฑู ููู ุนุดุงููุ",
"ูุง ุฃูุซุฑ ุชุตุฑู ูุฎููู ุชุฐูุจ ุญุจุ",
"ูู ุณุจู ูุดุนุฑุช ุฅูู ุชุญุจู ุฃูุซุฑุ",
"ูุง ุฃูุซุฑ ููุงู ูุฐููุฑู ูููุ",
"ูู ุชูุชูุฏู ููุง ูุฎุชููุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฎููู ูุถุญููุ",
"ูู ุชุนุชุจุฑู ุตุฏููู ูุจู ุญุจูุจูุ",
"ูุง ุฃูุซุฑ ูููู ุฎูุงู ุชุญุจู ุฃูุซุฑุ",
"ูุง ุฃูุซุฑ ุดูุก ุชุฎุงู ุชูููู ููุ",
"ูู ุณุจู ูุฎุจููุช ุนูู ุดูุกุ",
"ูู ุชุดูู ููุณู ุชุจุงุฏุฑ ุจุงูุญุจ ุฃูุซุฑุ",
"ูู ุชุนุชูุฏ ุฅู ุงูุตุฏู ุฃูู ูู ุงููุดุงุนุฑุ",
"ูู ุชุชููู ูู ูุฑุฌุน ููู ูู ุฃูุงููู ุงููุฏููุฉุ",
"ูุง ุฃูุซุฑ ุนุงุฏุฉ ุบุฑูุจุฉ ููู ุชุญุจูุงุ",
"ูู ุณุจู ูุตุงุฑ ุจูููู ุณูุก ุชูุงูู ูุถุญูุ",
"ูุง ุฃูุซุฑ ููุช ุชุญุจ ุชุชููููู ูููุ",
"ูู ุชุญุจ ุงูููุงููุงุช ุงูููููุฉุ",
"ูุง ุฃูุซุฑ ูููุฉ ุชุฐููุฑู ูููุ",
"ูู ุชุญุจ ุงูุชูุณู ููุง ุงููุณุงุญุฉ ูู ุงูุนูุงูุฉุ",
"ูู ุชุดุนุฑ ุฃูู ูุบุงุฑ ุนููู ูุซูุฑุ",
"ูู ุณุจู ูุดุนุฑุช ุฅูู ูุฎุงู ุนููู ุฃูุซุฑ ูู ููุณูุ",
"ูุง ุฃูุซุฑ ุชุตุฑู ุจุณูุท ุฎูุงู ุชุญุจู ุฃูุซุฑุ",
"ูู ุชุญุจ ุงูุฑุณุงุฆู ุงูุตุจุงุญูุฉุ",
"ูุง ุฃูุซุฑ ูุญุธุฉ ูุฏู ุชุนูุดูุง ูุนู ูู ุฌุฏูุฏุ",
"ูู ุชุนุชุจุฑ ุงูุนูุงูุฉ ุจูููู ูููุฉุ",
"ูู ุชุดูู ุงูุญุจ ููุงูุฉ ุจุฏูู ุงูุชูุงูุ",
"ูุง ุฃูุซุฑ ูููู ูุถุญู ุตุงุฑ ุจููููุ",
"ูู ุณุจู ููุงุฌุฃู ุจููุงููุฉ ูุฌุฃุฉุ",
"ูู ุชุชุฐูุฑ ุฃูู ูุฏูุฉ ูููุ",
"ูู ุชุญุจ ุงูุฑุณุงุฆู ุงูุทูููุฉ ุฃู ุงููุตูุฑุฉุ",
"ูุง ุฃูุซุฑ ุตูุช ุชุญุจู ูููุ",
"ูู ุชุญุจ ููุง ูุบุงุฑ ุนูููุ",
"ูุง ุฃูุซุฑ ูููุฉ ุชููููุง ูู ุฏุงุฆูุ",
"ูู ุณุจู ูููุช ูู ุฃุญุจู ุจุฏูู ุณุจุจุ",
"ูู ุชุชุฎููู ุดุฑูู ุญูุงุชู ููุฃุจุฏุ",
"ูู ุณุจู ูุจููุช ุนุดุงููุ",
"ูู ุชุญุจ ุงูุตูุช ูุนูุ",
"ูู ุดุนุฑุช ุฅูู ุชุชุนูู ููู ุฃุดูุงุกุ",
"ูู ุชุนุชุจุฑ ุงูุนูุงูุฉ ูุฏุฑุ",
"ูู ุชุญุจ ุงููุฏุงูุง ุฃู ุงููููุงุชุ",
"ูู ุชุนุชุจุฑู ูุตู ุงูุซุงููุ",
"ูุง ุฃูุซุฑ ุชุตุฑู ูุฎููู ุชููู (ูุง ุฃูุฏุฑ ุฃุฒุนู ููู)ุ",
"ูู ุดุนุฑุช ุฅูู ุงูุดุฎุต ุงูููุงุณุจ ูุนูุงูุ",
"ูู ุณุจู ูุชุฎููุช ุญูุงุชู ุจุฏูููุ",
"ูู ุณุจู ูููุช ูู ุดู ููุฏูุชุ",
"ูุง ุฃูุซุฑ ููุช ุชุญุณ ููู ุจุงูุญุจุ",
"ูู ุชุญุจ ุชุนุจุฑ ุจุงูููุงู ุฃู ุจุงูุฃูุนุงูุ",
"ูู ุชุญุจ ุงูููุงุฌุขุชุ",
"ูู ุณุจู ููุชุจุช ูู ุฑุณุงูุฉ ุทูููุฉุ",
"ูู ุชุญุจ ุงูููุงููุงุช ุงูููุงุฌุฆุฉุ",
"ูู ุชูุชูุฏู ุจุณุฑุนุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ุชุฎุงู ุชููุฏู ูููุ",
"ูู ุชุญุจ ุงูุงูุชูุงู ุงูุฒุงูุฏุ",
"ูู ุชุบุงุฑ ุจุณูููุฉุ",
"ูุง ุฃูุซุฑ ูููู ุฎูุงู ุชุซู ููู ุฃูุซุฑุ",
"ูู ุชุดุนุฑ ุฅูู ูุดุจูู ูุซูุฑุ",
"ูู ุชุญุจ ุงูุฌูุณุงุช ุงูุทูููุฉ ูุนูุ",
"ูุง ุฃูุซุฑ ูุญุธุฉ ุชุชููู ุชุฑุฌุนูุงุ",
"ูู ุชุญุณ ุจุงูุฑุงุญุฉ ููุง ุชุณูุน ุตูุชูุ",
"ูู ุชุญุจ ุงูููุงุฌุขุช ุงูุตุบูุฑุฉุ",
"ูู ุชูุถู ุงูุตุฑุงุญุฉ ุญุชู ูู ุฌุฑุญุชุ",
"ูุง ุฃูุซุฑ ูููุฉ ุชุญุจ ุชุณูุนูุง ูููุ",
"ูู ุดุนุฑุช ุจุงูุญุจ ุงูุญูููู ูุนูุ",
"ูู ุชุนุชุจุฑ ุงูุนูุงูุฉ ุงุฎุชุจุงุฑ ูููุดุงุนุฑุ",
"ูู ุชุญุจ ุชุนูุด ุงููุญุธุฉ ููุง ุชุฎุทุทุ",
"ูู ุชุดูู ููุณู ุดุฎุต ุนุงุทููุ",
"ูู ุชุญุจ ุงูุฑุณุงุฆู ุงูููููุฉุ",
"ูู ุชูุถู ุงูุชุนุจูุฑ ุจุงูููุณูููุ",
"ูู ุชุญุจ ุงูุฑุณุงุฆู ุงูููููุฉ ุงูุทูููุฉุ",
"ูุง ุฃูุซุฑ ุดูุก ูุฌุนูู ุชุจุชุณู ููุง ุชุชุฐูุฑูุ",
"ูู ุชูุฏุฑ ุชูุณู ูููู ุฒุนูู ููู ุจุณูููุฉุ",
"ูู ุชุญุณ ุฅู ุงูุญุจ ูุญุชุงุฌ ููุงู ูุซูุฑุ",
"ูู ุชูุถู ูููุฉ ุฃุญุจู ุฃู ููุณุฉ ุญูุงูุ",
"ูู ุชุญุณ ุงูุญุจ ุฎูู ุฃู ุดุบูุ",
"ูู ุชุญุจ ุงูุนูุงูุฉ ุงููุงุฏูุฉ ููุง ุงููุฌูููุฉุ",
"ูู ุชุนุชุจุฑ ููุณู ุงูุทุฑู ุงูุญุณุงุณ ุฃูุซุฑุ",
"ูู ุชุญุจ ุงูููุงุฌุขุช ูู ุงูููุงุณุจุงุชุ",
"ูู ุณุจู ูููุช ุฃุญุจู ูุงูุช ุฒุนูุงูุ",
"ูู ุชุญุจ ุงูุฅุดุงุฑุงุช ุงูุตุบูุฑุฉ ุงููู ุชุฏู ุนูู ุญุจุ",
"ูู ุชุนุชุจุฑ ุงูุบูุฑุฉ ุฏููู ุญุจุ",
"ูุง ุฃูุซุฑ ูููู ุฎูุงู ุชููู (ุฃูุง ูุนูุงู ุฃุญุจู).",
"ูู ุชุญุจ ููุง ููููู (ุงุดุชูุช ูู)ุ",
"ูู ุชุญุจ ุงูุฑุณุงุฆู ุงููู ุชุจุฏุฃ ุจุฏูู ุณุจุจุ",
"ูู ุชูุถู ุงูุนูุงูุฉ ุงูุบุงูุถุฉ ุฃู ุงูุตุฑูุญุฉุ",
"ูู ุชุญุจ ุงูุชูุงุตูู ุงูุตุบูุฑุฉุ",
"ูู ุชุญุณ ุงูุญุจ ูุจูู ูู ุงููุธุฑุงุชุ",
"ูู ุชูุถู ุงูููุงุกุงุช ุงููุตูุฑุฉ ุฃู ุงูุทูููุฉุ",
"ูู ุชุญุณ ุฅู ุงูุนูุงูุฉ ุจูููู ูุงุถุฌุฉุ",
"ูู ุชุนุชุจุฑ ุงูุญุจ ุตุจุฑุ",
"ูู ุณุจู ูููุช ูู ุณุฑ ูุง ููุชู ูุฃุญุฏุ",
"ูู ุชูุถู ุงูุฑุณุงุฆู ุงูุนุดูุงุฆูุฉุ",
"ูู ุชุญุจ ููุง ูุณุฃู ุนูู ุจุฏูู ุณุจุจุ",
"ูู ุชุญุณ ุงูุญุจ ูุงุฒู ุฅุนูุงูุ",
"ูู ุชุนุชุจุฑ ุงูุนูุงูุฉ ุจูููู ูููุฒุฉุ",
"ูู ุชุดูู ุงูุญุจ ูุฑุงุฑ ุฃู ุฅุญุณุงุณุ",
"ูู ุชุญุณ ุงูุนูุงูุฉ ุฎูุชู ุฃูููุ",
"ูู ุชุญุจ ููุง ููุชู ุจุชูุงุตูููุ",
"ูู ุชุนุชุจุฑ ุงูุงูุชูุงู ุฃูู ูู ุงูุญุจุ",
"ูู ุชุญุณ ุงูุนูุงูุฉ ุนููุชู ุงูุตุจุฑุ",
"ูู ุชุญุจ ุชุทููู ุนููู ูู ูููุ",
"ูู ุชุนุชุจุฑ ุงูุบูุงุจ ููุชู ุงูุญุจุ",
"ูู ุชุญุจ ุงูููุงุกุงุช ุงูููุงุฌุฆุฉุ",
"ูู ุชุดูู ุงูุญุจ ููุจุฑ ูุน ุงูููุชุ",
"ูู ุชุนุชุจุฑ ุงูุญุจ ุตุฏุงูุฉ ูุจู ูู ุดูุกุ",
"ูู ุชุญุณ ููุณู ุชุชุบูุฑ ุนุดุงููุ",
"ูู ุชุญุจ ุชุนูุดูู ูุบุงูุฑุงุช ุฌุฏูุฏุฉุ",
"ูู ุชุนุชุจุฑ ููุณู ุดุฎุต ูุบุงุฑ ูุซูุฑุ",
"ูู ุชุญุจ ุชุณูุน ูููุฉ (ูุญุดุชูู)ุ",
"ูู ุชุนุชุจุฑ ููุณู ุงูุทุฑู ุงูุฑููุงูุณูุ",
"ูู ุชุญุจ ููุง ููููู (ุฏูู ุชุถุญู)ุ",
"ูู ุชุญุณ ุงูุนูุงูุฉ ุจูููู ูุฑูุญุฉุ"
]

# -------------------------------------------------------
# ุฃูุนุงุจ ุฅุถุงููุฉ
# -------------------------------------------------------

# ุชุญุฏู ุงูุญุจ
love_challenges = [
    "ุงูุชุจ ูู ุฑุณุงูุฉ ุชุจุฏุฃ ุจูููุฉ (ุฃุญุจู ูุฃู...).",
    "ุดุงุฑู ูุนู ุฐูุฑู ูุง ุชูุณุงูุง.",
    "ูู ูู ุดู ุชุญุจู ููู ูุง ูุฏ ููุชู.",
    "ุงุฑุณูู ุตูุฑุฉ ูุฏููุฉ ุชุฌูุนูู.",
    "ุงุญูู ูู ุฃูู ูุญุธุฉ ุฎูู ูููุง ููุจู ูู.",
    "ุงูุชุจ ูู ุฑุณุงูุฉ ุตูุชูุฉ ูุตูุฑุฉ.",
    "ุฎุทุท ูููุงุฌุฃุฉ ุจุณูุทุฉ ูู ุงูููู.",
    "ุงุฑุณู ูู ุฑุณุงูุฉ ุญุจ ูู ููุช ุบูุฑ ูุชููุน.",
    "ุงูุชุจ ูู ุณุจุจ ูุฎููู ุชุจุชุณู ููุง ุชุชุฐูุฑู.",
    "ุงุฐูุฑ ูู ุนุงุฏุฉ ุจุณูุทุฉ ุชุญุจูุง ููู."
]

# ูุนุจุฉ ุงูุงุนุชุฑุงูุงุช
confessions = [
    "ุงุนุชุฑู ุจุฃูู ุดุฎุต ุฌุฐุจู ูู ุญูุงุชู.",
    "ุงุนุชุฑู ุจุฃูุซุฑ ุนุงุฏุฉ ุณูุฆุฉ ุนูุฏู.",
    "ุงุนุชุฑู ุจุดู ูุฏูุช ุนููู.",
    "ุงุนุชุฑู ุจุงุณู ุฃูู ุญุจ ูู ุญูุงุชู.",
    "ุงุนุชุฑู ุจุฃูุซุฑ ุดูุก ุชุฎุงู ููู.",
    "ุงุนุชุฑู ุจุณุฑ ูุง ููุชู ูุฃุญุฏ.",
    "ุงุนุชุฑู ุจูููู ูุญุฑุฌ ุตุงุฑ ูู.",
    "ุงุนุชุฑู ุจุดู ุฌููู ููู ูุง ุชูููู ูุซูุฑ.",
    "ุงุนุชุฑู ุจุดุฎุต ุชุชููู ุชุนุชุฐุฑ ูู.",
    "ุงุนุชุฑู ุจุฃูุซุฑ ูููู ุฃุซุฑ ููู."
]

user_asked_questions = {}

# -------------------------------------------------------
# ุงูุฑุฏูุฏ ุงูุฑุฆูุณูุฉ
# -------------------------------------------------------
@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers.get('X-Line-Signature', '')
    body = request.get_data(as_text=True)
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'


@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    user_id = event.source.user_id
    text = event.message.text.strip().lower()

    if "ุณุคุงู" in text or "ุณูุงู" in text:
        asked = user_asked_questions.get(user_id, set())
        available = [q for q in questions if q not in asked]
        if not available:
            user_asked_questions[user_id] = set()
            available = questions.copy()
        q = random.choice(available)
        user_asked_questions.setdefault(user_id, set()).add(q)
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=q))
        return

    elif "ุชุญุฏู" in text:
        c = random.choice(love_challenges)
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=f"๐ {c}"))
        return

    elif "ุงุนุชุฑุงู" in text:
        conf = random.choice(confessions)
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=f"๐ฉท {conf}"))
        return

    elif "ูุณุงุนุฏุฉ" in text:
        help_text = (
            "โค๏ธ ุฃูุงูุฑ ุงูุจูุช:\n"
            "- 'ุณุคุงู' ุฃู 'ุณูุงู' โ ุณุคุงู ุญุจ ุฃู ุตุฑุงุญุฉ ุนุดูุงุฆู.\n"
            "- 'ุชุญุฏู' โ ุชุญุฏู ุญุจ ุฑููุงูุณู.\n"
            "- 'ุงุนุชุฑุงู' โ ุณุคุงู ุงุนุชุฑุงู ุตุฑูุญ.\n"
            "- 'ูุณุงุนุฏุฉ' โ ุนุฑุถ ุงูุฃูุงูุฑ.\n"
            "ูู ูุฑุฉ ุงูุฃุณุฆูุฉ ูุงูุชุญุฏูุงุช ุชุชุบูุฑ ุชููุงุฆููุง ๐ซ"
        )
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=help_text))
        return

    # ูุง ูุฑุฏ ุนูู ุฃู ุดูุก ุขุฎุฑ
    return


if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)
